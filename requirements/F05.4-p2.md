# F05.4: Morning Brief ‚Äî P2 Integration

## Overview

| Attribute | Value |
|-----------|-------|
| Feature ID | F05.4 |
| Parent | F05 (Morning Brief) |
| Priority | Phase 3 (Rituals) |
| Dependencies | F10 (External Sources) |

## Purpose

Pull P2 posts, comments, and mentions to surface important internal communications. Identify threads where user input is needed or where activity has occurred on user's posts.

---

## Requirements

| ID | Requirement | Priority |
|----|-------------|----------|
| F05.4.1 | Pull posts authored by user since last brief | Must |
| F05.4.2 | Pull comments by user since last brief | Must |
| F05.4.3 | Pull posts/comments mentioning user | Must |
| F05.4.4 | Pull replies to user's posts | Must |
| F05.4.5 | Show P2 name, post title, link | Must |
| F05.4.6 | Identify posts awaiting user response | Should |
| F05.4.7 | Surface engagement on user's posts | Should |

---

## Access Method

| Setting | Value |
|---------|-------|
| Protocol | MCP (Model Context Protocol) |
| Server | context-a8c |
| Auth | Handled by MCP server |

The context-a8c MCP server provides P2 access for Automattic internal blogs.

---

## What is P2?

P2 is Automattic's internal blogging/communication platform built on WordPress. Key concepts:

- **P2 site**: A team or project blog (e.g., Domain Team P2, Company Updates)
- **Post**: A blog entry, often used for updates, proposals, discussions
- **Comment**: Replies to posts, threaded discussion
- **Mention**: @username reference in post or comment

---

## Query Parameters

```
Pull from context-a8c:
  - Posts by user since: {last_brief_timestamp}
  - Comments by user since: {last_brief_timestamp}
  - Posts/comments mentioning user since: {last_brief_timestamp}
  - Replies to user's posts since: {last_brief_timestamp}
```

---

## Data Retrieved

```json
{
  "items": [
    {
      "type": "post",
      "p2_site": "domain-team",
      "title": "Q1 Transfer Pricing Analysis",
      "author": {
        "username": "paolo",
        "display_name": "Paolo"
      },
      "content": "Here's my analysis of the Q1 transfer pricing...",
      "url": "https://domain-team.p2.automattic.com/2025/01/31/q1-transfer-pricing",
      "date": "2025-01-31T08:00:00Z",
      "status": "publish",
      "comment_count": 3,
      "new_comments_since_last_brief": 2
    },
    {
      "type": "comment",
      "p2_site": "domain-team",
      "post_title": "Weekly Standup Notes",
      "post_url": "https://domain-team.p2.automattic.com/...",
      "author": {
        "username": "manager",
        "display_name": "Manager Name"
      },
      "content": "@paolo can you elaborate on the bundling timeline?",
      "url": "https://domain-team.p2.automattic.com/...#comment-123",
      "date": "2025-01-31T09:30:00Z",
      "is_mention": true,
      "is_reply_to_user": false
    },
    {
      "type": "comment",
      "p2_site": "domain-team",
      "post_title": "Q1 Transfer Pricing Analysis",
      "post_url": "https://domain-team.p2.automattic.com/...",
      "author": {
        "username": "colleague",
        "display_name": "Colleague Name"
      },
      "content": "Great analysis! One question about the assumptions...",
      "url": "https://domain-team.p2.automattic.com/...#comment-456",
      "date": "2025-01-31T10:00:00Z",
      "is_mention": false,
      "is_reply_to_user": true
    }
  ]
}
```

---

## Processing Logic

### 1. Categorize Items

| Category | Criteria | Priority |
|----------|----------|----------|
| Direct Mention | @user in content | High |
| Reply to User's Post | Comment on user's post | High |
| New Activity on User's Post | Engagement metrics up | Medium |
| User's Recent Posts | Posts by user | Low (FYI) |

### 2. Identify Response Needed

```
For each item:
  If is_mention AND no user reply after:
    response_needed = true
  If is_reply_to_user AND asks question:
    response_needed = true
```

### 3. Engagement Summary

For user's posts, summarize activity:

```
Your post "Q1 Transfer Pricing Analysis"
  Published: 08:00 today
  Comments: 3 (2 new since last brief)
  Notable: @colleague asked about assumptions
```

---

## Output Format

### In Daily Note

Combined with Slack in the brief:

```markdown
### Slack & P2

**P2 Mentions**
- **Domain Team P2**: @manager asking about bundling timeline
  in "Weekly Standup Notes"
  ‚Üí [View comment](https://domain-team.p2.automattic.com/...#comment-123)

**Activity on Your Posts**
- **"Q1 Transfer Pricing Analysis"** received 2 new comments
  @colleague asks about assumptions
  ‚Üí [View post](https://domain-team.p2.automattic.com/...)
```

### In Terminal (Interactive)

```
P2 (2 items)

1. Mention in Domain Team P2
   Post: "Weekly Standup Notes"
   @manager: "Can you elaborate on the bundling timeline?"
   
   Actions:
     [r] Add "Reply on P2" to priorities
     [o] Open in browser
     [s] Skip
   
   Choice: _

2. Activity on your post
   "Q1 Transfer Pricing Analysis" ‚Äî 2 new comments
   @colleague asks about pricing assumptions
   
   Actions:
     [v] View comments
     [r] Add "Reply to comments" to priorities
     [s] Skip
   
   Choice: _
```

---

## P2 vs. Slack Distinction

Both come from context-a8c MCP, but serve different purposes:

| P2 | Slack |
|----|-------|
| Async, longer-form | Real-time, conversational |
| Persistent record | Ephemeral discussion |
| Formal updates/proposals | Quick questions/coordination |
| Company-wide visibility | Channel/DM scoped |

In the brief, they're combined under "Slack & P2" for simplicity, but P2 items are labeled.

---

## Post Publishing Tracking

When user publishes a post, the system tracks:
- Initial publish time
- Comment count over time
- Who engaged (for People integration)

This surfaces in the brief:

```
üìù Your post "Q1 Pricing Analysis" is getting traction
   3 comments in first 2 hours
   Key commenters: @manager, @colleague
```

---

## Failure Handling

| Failure | Behavior |
|---------|----------|
| MCP unavailable | Skip P2, show warning |
| MCP timeout | Retry once, then skip |
| Specific P2 inaccessible | Warn, continue with others |
| No activity | Show "No P2 updates" |

```
‚ö† P2: context-a8c MCP not responding
  Skipping P2 section.
```

Since Slack and P2 use the same MCP, they typically fail together.

---

## Configuration

```yaml
sources:
  p2:
    enabled: true
    mcp: context-a8c
    track_my_posts: true      # Surface engagement on user's posts
    include_sites: all        # or specific P2 site slugs
    exclude_sites: []         # P2s to ignore
```

---

## Privacy Considerations

- P2 content is internal but may contain sensitive info
- Summaries in daily note should be general
- Full content available via links, not copied
- Respect team/project confidentiality norms

---

## Validation

| Check | Expected |
|-------|----------|
| Mentions retrieved | ‚úì |
| Replies to user's posts retrieved | ‚úì |
| User's posts tracked | ‚úì |
| Links work | ‚úì |
| Combined with Slack cleanly | ‚úì |

---

## Related Features

- **F05 (Morning Brief Core)**: Orchestration
- **F05.3 (Slack)**: Co-located in brief output
- **F10 (External Sources)**: MCP configuration
