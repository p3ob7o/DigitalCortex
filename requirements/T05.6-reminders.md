# T05.6: Morning Brief — Reminders Integration — Tests

## Test Environment

```
test-vault-populated/
```

**Mocks:**
- osascript / Reminders CLI responses
- System clock: 2025-01-31T08:00:00+01:00
- No actual Reminders app interaction

---

## Test Suite: Reminder Retrieval

### T05.6.1: Fetch reminders due today
**Code type:** Python script

```pseudo
GIVEN mock Reminders returns 3 items due on 2025-01-31
WHEN fetch_reminders(due="today")
THEN returns 3 reminder items
AND all have due_date = 2025-01-31
```

### T05.6.2: Fetch overdue reminders
**Code type:** Python script

```pseudo
GIVEN mock Reminders returns 1 item due on 2025-01-30
AND today = 2025-01-31
WHEN fetch_reminders()
THEN item marked as overdue = true
```

### T05.6.3: Fetch upcoming reminders (3 days)
**Code type:** Python script

```pseudo
GIVEN config.reminders.upcoming_days = 3
AND reminders due on 2025-02-01, 2025-02-02, 2025-02-03
WHEN fetch_reminders()
THEN all 3 included in "upcoming" category
```

### T05.6.4: Fetch from multiple lists
**Code type:** Python script

```pseudo
GIVEN config.reminders.lists = ["Reminders", "Shopping"]
WHEN fetch_reminders()
THEN returns items from both lists
AND items tagged with their source list
```

### T05.6.5: Exclude completed reminders
**Code type:** Python script

```pseudo
GIVEN mock returns completed and incomplete reminders
WHEN fetch_reminders()
THEN only incomplete reminders returned
```

---

## Test Suite: Categorization

### T05.6.6: Categorize overdue (high priority)
**Code type:** Python script

```pseudo
GIVEN reminder due yesterday
WHEN categorize_reminder(reminder)
THEN category = "overdue"
AND priority = "high"
AND flag = "⚠"
```

### T05.6.7: Categorize due today with time
**Code type:** Python script

```pseudo
GIVEN reminder due today at 10:00
WHEN categorize_reminder(reminder)
THEN category = "due_today"
AND has_time = true
AND time = "10:00"
```

### T05.6.8: Categorize due today without time
**Code type:** Python script

```pseudo
GIVEN reminder due today with no specific time
WHEN categorize_reminder(reminder)
THEN category = "due_today"
AND has_time = false
```

### T05.6.9: Categorize upcoming
**Code type:** Python script

```pseudo
GIVEN reminder due in 2 days
WHEN categorize_reminder(reminder)
THEN category = "upcoming"
```

### T05.6.10: Sort order within categories
**Code type:** Python script

```pseudo
GIVEN mixed reminders
WHEN sorting for display
THEN order is:
  1. Overdue (oldest first)
  2. Due today with time (earliest time first)
  3. Due today without time
  4. Upcoming (soonest first)
```

---

## Test Suite: Shopping List

### T05.6.11: Separate shopping list from reminders
**Code type:** Python script

```pseudo
GIVEN reminders in "Reminders" list
AND items in "Shopping" list
WHEN fetch_reminders()
THEN returns separate structures:
  - reminders: [...]
  - shopping: [...]
```

### T05.6.12: Shopping items have no due dates
**Code type:** Python script

```pseudo
GIVEN shopping list items
WHEN processing items
THEN due_date not required
AND items show as "when shopping"
```

### T05.6.13: Format shopping list
**Code type:** Python script

```pseudo
GIVEN 3 shopping items: Milk, Bread, Eggs
WHEN format_shopping_section()
THEN output:
  "**Shopping List** (3 items)
   - Milk
   - Bread
   - Eggs"
```

---

## Test Suite: Output Formatting

### T05.6.14: Format overdue reminder
**Code type:** Python script

```pseudo
GIVEN overdue reminder: "Reply to insurance email"
WHEN format_for_brief(reminder)
THEN output:
  "- ⚠ Reply to insurance email (overdue)"
```

### T05.6.15: Format reminder with time
**Code type:** Python script

```pseudo
GIVEN reminder: "Call dentist" due at 10:00
WHEN format_for_brief(reminder)
THEN output:
  "- Call dentist @ 10:00"
```

### T05.6.16: Format reminder without time
**Code type:** Python script

```pseudo
GIVEN reminder: "Check deployment status" due today, no time
WHEN format_for_brief(reminder)
THEN output:
  "- Check deployment status (today)"
```

### T05.6.17: Format upcoming with day
**Code type:** Python script

```pseudo
GIVEN reminder due 2025-02-01 (Saturday)
WHEN format_for_brief(reminder)
THEN output includes:
  "- Pay rent (Feb 1)" or "- Pay rent (Saturday)"
```

### T05.6.18: Combined Tasks & Reminders section
**Code type:** Python script

```pseudo
GIVEN Linear tasks and Apple Reminders
WHEN format_combined_section()
THEN output structure:
  "### Tasks & Reminders
   
   **Due Today (Linear)**
   - [ ] DOMAIN-456: ...
   
   **Reminders**
   - Call dentist @ 10:00
   - Check deployment
   
   **Shopping**
   - Milk..."
```

---

## Test Suite: Write Capabilities

### T05.6.19: Create reminder
**Code type:** Python script

```pseudo
GIVEN command: create_reminder("Call dentist", due="tomorrow 10:00")
WHEN osascript is executed
THEN reminder created with:
  - list: "Reminders"
  - title: "Call dentist"
  - due_date: 2025-02-01
  - due_time: 10:00
```

### T05.6.20: Create reminder without time
**Code type:** Python script

```pseudo
GIVEN command: create_reminder("Pay rent", due="2025-02-01")
WHEN osascript is executed
THEN reminder created with due date but no time
```

### T05.6.21: Add to shopping list
**Code type:** Python script

```pseudo
GIVEN command: add_shopping(["Milk", "Bread", "Eggs"])
WHEN osascript is executed
THEN 3 items added to "Shopping" list
AND items have no due dates
```

### T05.6.22: Batch add shopping items
**Code type:** Python script

```pseudo
GIVEN user says: "/shopping milk, bread, eggs, butter"
WHEN parsing and creating
THEN 4 separate items created in Shopping list
```

---

## Test Suite: Time-Based Interactions

### T05.6.23: Flag conflict with calendar
**Code type:** Prompt/Response

```pseudo
GIVEN reminder at 10:00
AND calendar event at 10:00 (standup)
WHEN brief is generated
THEN Claude notes conflict:
  "Reminder 'Call dentist' at 10:00 conflicts with Standup
   → Call before standup (09:45) or reschedule?"
```

### T05.6.24: Suggest time slot for reminder
**Code type:** Prompt/Response

```pseudo
GIVEN reminder due today with no time
AND calendar has open blocks
WHEN interactive review
THEN Claude suggests:
  "When do you want to do 'Check deployment'?
   Open slots: 08:00-09:45, 10:30-13:45"
```

---

## Test Suite: Error Handling

### T05.6.25: Handle osascript failure
**Code type:** Python script

```pseudo
GIVEN mock osascript returns error
WHEN fetch_reminders()
THEN retries once
AND if still fails, raises RemindersError
```

### T05.6.26: Handle permission denied
**Code type:** Python script

```pseudo
GIVEN mock returns "Not authorized to access Reminders"
WHEN fetch_reminders()
THEN raises PermissionError
AND message: "Grant access in System Preferences > Privacy > Reminders"
```

### T05.6.27: Handle list not found
**Code type:** Python script

```pseudo
GIVEN config references list "Work" that doesn't exist
WHEN fetch_reminders()
THEN warns: "Reminders list 'Work' not found"
AND continues with available lists
```

### T05.6.28: Handle empty lists
**Code type:** Python script

```pseudo
GIVEN no reminders due
WHEN fetch_reminders()
THEN returns empty structures
AND brief shows: "No reminders due"
```

---

## Test Suite: Interactive Actions

### T05.6.29: Mark reminder complete
**Code type:** Prompt/Response

```pseudo
GIVEN overdue reminder in brief
WHEN user says "done" or "completed"
THEN Claude marks reminder complete via osascript
```

### T05.6.30: Reschedule reminder
**Code type:** Prompt/Response

```pseudo
GIVEN reminder due today
WHEN user says "move to tomorrow"
THEN Claude updates due date via osascript
```

### T05.6.31: Delete reminder
**Code type:** Prompt/Response

```pseudo
GIVEN reminder user wants to delete
WHEN user confirms deletion
THEN Claude deletes via osascript
AND confirms deletion
```

---

## Mock Fixtures

### osascript mock responses
```python
MOCK_REMINDERS = {
    "reminders": [
        {
            "id": "reminder-123",
            "list": "Reminders",
            "title": "Call dentist",
            "due_date": "2025-01-31T10:00:00",
            "has_time": True,
            "completed": False,
            "priority": 0,
            "notes": "Reschedule annual checkup"
        },
        {
            "id": "reminder-456",
            "list": "Reminders",
            "title": "Check deployment status",
            "due_date": "2025-01-31",
            "has_time": False,
            "completed": False
        },
        {
            "id": "reminder-789",
            "list": "Reminders",
            "title": "Reply to insurance email",
            "due_date": "2025-01-30",
            "has_time": False,
            "completed": False,
            "overdue": True
        }
    ],
    "shopping": [
        {"id": "shop-001", "list": "Shopping", "title": "Milk", "completed": False},
        {"id": "shop-002", "list": "Shopping", "title": "Bread", "completed": False},
        {"id": "shop-003", "list": "Shopping", "title": "Eggs", "completed": False}
    ]
}
```
