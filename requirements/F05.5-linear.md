# F05.5: Morning Brief â€” Linear Integration

## Overview

| Attribute | Value |
|-----------|-------|
| Feature ID | F05.5 |
| Parent | F05 (Morning Brief) |
| Priority | Phase 3 (Rituals) |
| Dependencies | F10 (External Sources), F14 (Bootstrap for auth) |

## Purpose

Pull assigned tasks from Linear to show what's on the user's plate, surface completed work for wins, and identify blocked or overdue items. This is the primary source for task-related content in the morning brief.

---

## Requirements

| ID | Requirement | Priority |
|----|-------------|----------|
| F05.5.1 | Pull all issues assigned to user (all teams) | Must |
| F05.5.2 | Pull issues completed since last brief | Must |
| F05.5.3 | Show issue identifier, title, status, due date | Must |
| F05.5.4 | Highlight overdue issues | Must |
| F05.5.5 | Highlight blocked issues | Must |
| F05.5.6 | Group by team or project | Should |
| F05.5.7 | Link issues to Obsidian projects when mapped | Should |

---

## Access Method

| Setting | Value |
|---------|-------|
| API | Linear GraphQL API |
| Auth | OAuth 2.0 or API key |
| Scope | Read: all teams; Write: personal team only |

---

## Query Parameters

### Active Issues

```graphql
query {
  issues(
    filter: {
      assignee: { id: { eq: "user-id" } }
      state: { type: { nin: ["completed", "canceled"] } }
    }
    orderBy: updatedAt
  ) {
    nodes {
      id
      identifier
      title
      description
      state { name type }
      priority
      dueDate
      project { id name }
      team { id name key }
      labels { nodes { name } }
      createdAt
      updatedAt
    }
  }
}
```

### Completed Since Last Brief

```graphql
query {
  issues(
    filter: {
      assignee: { id: { eq: "user-id" } }
      completedAt: { gte: "{last_brief_timestamp}" }
    }
  ) {
    nodes {
      id
      identifier
      title
      completedAt
      project { name }
      team { name }
    }
  }
}
```

---

## Data Retrieved

```json
{
  "active_issues": [
    {
      "id": "issue-123",
      "identifier": "DOMAIN-456",
      "title": "Update pricing documentation",
      "description": "Revise pricing page with new tiers...",
      "state": {
        "name": "In Progress",
        "type": "started"
      },
      "priority": 2,
      "dueDate": "2025-02-14",
      "project": {
        "id": "proj-789",
        "name": "Domain Bundling"
      },
      "team": {
        "id": "team-abc",
        "name": "Domain",
        "key": "DOMAIN"
      },
      "labels": [
        { "name": "Domaison" }
      ],
      "createdAt": "2025-01-20T10:00:00Z",
      "updatedAt": "2025-01-30T16:00:00Z"
    }
  ],
  "completed_issues": [
    {
      "id": "issue-100",
      "identifier": "DOMAIN-123",
      "title": "Review mockups",
      "completedAt": "2025-01-30T16:00:00Z",
      "project": { "name": "BI Phase 1" },
      "team": { "name": "Domain" }
    }
  ]
}
```

---

## Processing Logic

### 1. Categorize Issues

| Category | Criteria | Treatment |
|----------|----------|-----------|
| Overdue | dueDate < today | âš  Highlight red |
| Due Today | dueDate == today | Highlight in brief |
| Due This Week | dueDate within 7 days | Include in brief |
| Blocked | state.name contains "blocked" | âš  Call out |
| In Progress | state.type == "started" | Normal listing |
| Backlog | state.type == "backlog" | Omit unless relevant |

### 2. Priority Mapping

| Linear Priority | Display |
|-----------------|---------|
| 0 (No priority) | â€” |
| 1 (Urgent) | ðŸ”´ Urgent |
| 2 (High) | ðŸŸ  High |
| 3 (Normal) | â€” |
| 4 (Low) | ðŸ”µ Low |

### 3. Project Linking

Match Linear projects to Obsidian projects:

```
For each issue.project:
  Search 3_Projects/ for file with linear_project == project.id
  If found:
    Link to Obsidian project
```

### 4. Team Grouping

Group issues by team for readability:

```
Domain Team (3 issues)
  â€¢ DOMAIN-456: Update pricing documentation (due Feb 14)
  â€¢ DOMAIN-789: Review API spec (in progress)
  â€¢ DOMAIN-111: Fix billing edge case (blocked)

Jetpack Team (1 issue)
  â€¢ JETPACK-222: Add domain upsell (due Feb 1)
```

---

## Output Format

### In Daily Note

```markdown
### Tasks & Reminders

**Completed Since Yesterday**
- [x] Review mockups (DOMAIN-123)
- [x] Send weekly report (TOTORO-12)

**Due Today**
- [ ] ðŸŸ  Send revised pricing (DOMAIN-456) â€” [[domain-bundling]]

**Due This Week**
- [ ] Prepare Q1 review deck (TOTORO-15) â€” Monday
- [ ] ðŸ”´ Fix billing edge case (DOMAIN-111) â€” **BLOCKED**

**In Progress**
- [ ] Update pricing documentation (DOMAIN-456) â€” due Feb 14
```

### In Terminal (Interactive)

```
LINEAR TASKS

Completed since last brief:
  âœ“ DOMAIN-123: Review mockups
  âœ“ TOTORO-12: Send weekly report

Due today:
  ðŸŸ  DOMAIN-456: Send revised pricing
     Project: Domain Bundling
     
     Is this still on track?
       [y] Yes
       [m] Move to tomorrow
       [b] Mark as blocked

Due this week:
  â€¢ TOTORO-15: Prepare Q1 review deck (Mon)
  â€¢ DOMAIN-111: Fix billing edge case (Wed) â€” BLOCKED
    Blocked by: Waiting on Legal approval

In progress (5 total):
  â€¢ DOMAIN-456: Update pricing documentation
  â€¢ [4 more...]
  
  [v] View all tasks
  [s] Skip to next section
```

---

## Blocked Issue Handling

When an issue is blocked:

```markdown
- [ ] Fix billing edge case (DOMAIN-111) â€” **BLOCKED**
  Blocker: Waiting on Legal approval
  Blocked since: 3 days
```

In terminal:

```
âš  BLOCKED ISSUES

DOMAIN-111: Fix billing edge case
  Status: Blocked
  Reason: Waiting on Legal approval
  Blocked: 3 days
  
  Actions:
    [f] Add follow-up to priorities
    [u] Update status
    [s] Skip
```

---

## Wins Section

Completed issues are surfaced as "wins" for motivation:

```markdown
### Completed Since Yesterday
- [x] Review mockups (DOMAIN-123)
- [x] Send weekly report (TOTORO-12)

ðŸŽ‰ 2 tasks completed!
```

---

## Write Capabilities

For the personal team (Totoro), Claude can:

| Operation | Allowed |
|-----------|---------|
| Create issue | âœ“ |
| Update title/description | âœ“ |
| Change status | âœ“ |
| Set due date | âœ“ |
| Add to project | âœ“ |
| Assign (self only) | âœ“ |

Other teams are read-only.

Example during brief:

```
Email from Legal requests "Review terms by EOD"

Create task in Linear?
  Team: Totoro (personal)
  Title: Review Legal terms
  Due: Today
  
  [y] Create
  [e] Edit first
  [n] Skip
```

---

## Failure Handling

| Failure | Behavior |
|---------|----------|
| Auth expired | Skip Linear, prompt to re-auth |
| API timeout | Retry once, then use cached if <4h |
| Rate limited | Use cached data |
| No issues | Show "No tasks assigned ðŸŽ‰" |

```
âš  Linear: Authentication expired
  Run `claude auth linear` to reconnect.
  Using cached task list (2 hours old).
```

---

## Configuration

```yaml
sources:
  linear:
    enabled: true
    personal_team: Totoro
    personal_team_id: "team-uuid-here"
    show_completed_days: 1    # How far back to show completed
    group_by: team            # team | project | priority
    include_backlog: false    # Show backlog items?
```

---

## Obsidian Project Mapping

Linear projects map to Obsidian projects via frontmatter:

```yaml
# 3_Projects/domain-bundling/domain-bundling.md
---
type: project
linear_project: "proj-789"
---
```

When this mapping exists:
- Issues from that Linear project link to the Obsidian project
- Brief can reference `[[domain-bundling]]`

---

## Validation

| Check | Expected |
|-------|----------|
| Active issues retrieved | âœ“ |
| Completed issues retrieved | âœ“ |
| Due dates parsed correctly | âœ“ |
| Blocked issues highlighted | âœ“ |
| Project mapping works | âœ“ |
| Write to personal team works | âœ“ |

---

## Related Features

- **F05 (Morning Brief Core)**: Uses tasks for priorities
- **F09 (Task Management)**: Full task management details
- **F10 (External Sources)**: Linear configuration
- **F04 (Frontmatter)**: Project schema with `linear_project`
