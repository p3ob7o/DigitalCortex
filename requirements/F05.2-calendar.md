# F05.2: Morning Brief â€” Calendar Integration

## Overview

| Attribute | Value |
|-----------|-------|
| Feature ID | F05.2 |
| Parent | F05 (Morning Brief) |
| Priority | Phase 3 (Rituals) |
| Dependencies | F10 (External Sources), F14 (Bootstrap for auth) |

## Purpose

Pull today's calendar events to show the day's schedule, identify open blocks for work, link attendees to People files, and surface relevant context for meetings.

---

## Requirements

| ID | Requirement | Priority |
|----|-------------|----------|
| F05.2.1 | Pull all events for today | Must |
| F05.2.2 | Show event time, title, location | Must |
| F05.2.3 | Identify open blocks between meetings | Must |
| F05.2.4 | Link attendees to People files when matched | Must |
| F05.2.5 | Surface last interaction with attendees | Should |
| F05.2.6 | Include conference links (Zoom, Meet) | Should |
| F05.2.7 | Flag conflicts or back-to-back meetings | Should |

---

## Access Method

| Setting | Value |
|---------|-------|
| API | Google Calendar API |
| Auth | OAuth 2.0 (shared with Gmail if same account) |
| Scope | `calendar.readonly`, `calendar.events` (for write) |

---

## Query Parameters

```
Pull events where:
  - timeMin: today 00:00 (user timezone)
  - timeMax: today 23:59 (user timezone)
  - calendars: configured list or "all"
  - singleEvents: true (expand recurring)
  - orderBy: startTime
```

### Configuration

From `config.yaml`:

```yaml
sources:
  calendar:
    enabled: true
    calendars: all  # or specific IDs
    # calendars:
    #   - primary
    #   - team-calendar-id
```

---

## Data Retrieved

For each event:

```json
{
  "id": "event-123",
  "summary": "Weekly Standup",
  "description": "Domain team sync",
  "start": {
    "dateTime": "2025-01-31T10:00:00+01:00",
    "timeZone": "Europe/Vienna"
  },
  "end": {
    "dateTime": "2025-01-31T10:30:00+01:00",
    "timeZone": "Europe/Vienna"
  },
  "location": "Zoom",
  "attendees": [
    {
      "email": "jane@verisign.com",
      "displayName": "Jane Smith",
      "responseStatus": "accepted"
    },
    {
      "email": "paolo@automattic.com",
      "displayName": "Paolo",
      "self": true,
      "responseStatus": "accepted"
    }
  ],
  "conferenceData": {
    "entryPoints": [
      {
        "entryPointType": "video",
        "uri": "https://zoom.us/j/123456"
      }
    ]
  },
  "status": "confirmed",
  "organizer": {
    "email": "jane@verisign.com"
  }
}
```

---

## Processing Logic

### 1. Build Schedule

```
08:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Open
09:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Open
10:00 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Weekly Standup
10:30 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
11:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Open
12:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Open
13:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Open
14:00 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 1:1 with Jane Smith
15:00 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
16:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Open
17:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Open
18:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ End of day
```

### 2. Identify Open Blocks

Calculate contiguous open periods:

```
Open blocks:
  08:00â€“10:00 (2 hours)
  10:30â€“14:00 (3.5 hours)
  15:00â€“18:00 (3 hours)
```

Apply buffer preferences (from config or memory):
- 15 min before meetings by default
- Adjusted blocks: 08:00â€“09:45, 10:30â€“13:45, 15:00â€“18:00

### 3. Match Attendees to People

```
For each event.attendees:
  If not self:
    Search 8_People/ for matching email
    If found:
      Attach person context
      Get last interaction date
```

### 4. Detect Issues

| Issue | Detection | Alert |
|-------|-----------|-------|
| Conflict | Overlapping events | âš  Conflict |
| Back-to-back | <15 min gap | âš  No buffer |
| All-day blocked | No open blocks | âš  Meeting-heavy day |
| Early meeting | Before 09:00 | â„¹ Early start |

---

## Output Format

### In Daily Note

```markdown
### Calendar

- **10:00â€“10:30** Weekly Standup (Domain team)
  ğŸ“ Zoom Â· [Join](https://zoom.us/j/123456)
  
- **14:00â€“15:00** 1:1 with [[Jane Smith]]
  ğŸ“ Zoom Â· [Join](https://zoom.us/j/789012)
  ğŸ‘¤ Last contact: Jan 28 â€” discussed bulk discount proposal

**Open blocks:** 08:00â€“09:45, 10:30â€“13:45, 15:00â€“18:00
```

### In Terminal (Interactive)

```
CALENDAR â€” Friday, January 31

  10:00  Weekly Standup (Domain team)
         ğŸ“ Zoom
         
  14:00  1:1 with Jane Smith
         ğŸ“ Zoom
         ğŸ‘¤ Verisign Â· Last: Jan 28 (bulk discount discussion)

Open blocks for deep work:
  â€¢ 08:00â€“09:45 (1h 45m) â€” before standup
  â€¢ 10:30â€“13:45 (3h 15m) â€” midday
  â€¢ 15:00â€“18:00 (3h) â€” afternoon

No conflicts detected âœ“
```

---

## People Integration

When an attendee matches a People file:

```markdown
- **14:00â€“15:00** 1:1 with [[Jane Smith]]
  ğŸ‘¤ Verisign Â· Partner Manager
  ğŸ“ Last contact: Jan 28
  ğŸ’¬ Context: Discussed bulk discount proposal, waiting on leadership
```

When attendee is unknown:

```
Meeting at 14:00 with sarah@newcompany.com

This person isn't in your People folder.
Create a file before the meeting?

  [y] Yes, create now
  [n] No
  [a] After the meeting (add reminder)
```

---

## Open Block Usage

Open blocks are used by F05 Core for time slot suggestions:

```
Priority: Respond to Legal on pricing
Duration estimate: 1 hour (complex email)
Best slot: 08:00â€“09:00 (quiet, before meetings)

Priority: Quick Slack replies
Duration estimate: 30 min
Best slot: 10:30â€“11:00 (post-standup energy)
```

---

## Write Capabilities

Calendar supports creating events on explicit user request:

```
User: "Block 2 hours tomorrow morning for deep work"

Creating calendar event:
  Title: Deep Work Block
  Time: 2025-02-01 09:00â€“11:00
  Calendar: Primary
  
Confirm? [y/n]
```

This is NOT automaticâ€”requires explicit user request.

---

## All-Day Events

Handle all-day events separately:

```markdown
### Calendar

ğŸ“… **All day:** Company Holiday (US)

- **10:00â€“10:30** Weekly Standup
  ...
```

All-day events don't block time slots but are noted for context.

---

## Failure Handling

| Failure | Behavior |
|---------|----------|
| Auth expired | Skip calendar, show warning |
| API timeout | Retry once, then skip |
| No events | Show "No meetings today ğŸ‰" |
| Calendar not found | Warn and skip that calendar |

```
âš  Calendar: Could not access "Team Calendar"
  Showing events from primary calendar only.
```

---

## Configuration

```yaml
sources:
  calendar:
    enabled: true
    calendars: all
    buffer_minutes: 15        # Before meetings
    working_hours:
      start: "08:00"
      end: "18:00"
    exclude_all_day: false    # Include all-day events
```

---

## Weekly Review Extension

For weekly review (F07), calendar pulls Â±1 week:

- Past week: What happened, pattern analysis
- Next week: Prep needed, busy days identified

This is triggered by F07, not F05.

---

## Validation

| Check | Expected |
|-------|----------|
| Today's events retrieved | âœ“ |
| Times in user timezone | âœ“ |
| Attendees matched to People | âœ“ |
| Open blocks calculated | âœ“ |
| Conference links included | âœ“ |
| Conflicts detected | âœ“ |

---

## Related Features

- **F05 (Morning Brief Core)**: Uses calendar for scheduling
- **F07 (Weekly Review)**: Extended calendar view
- **F10 (External Sources)**: Calendar configuration
- **F15 (People)**: Attendee matching
